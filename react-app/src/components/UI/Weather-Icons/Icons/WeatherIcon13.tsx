import { useEffect, useRef, useContext } from 'react';
import gsap from 'gsap';
import { CustomEase } from 'gsap/CustomEase';

import styles from './WeatherIcons.module.css';
import ThemeContext from '../../../../store/theme-context';

const WeatherIcon13 = (props: { description: string }) => {
  const snowCrystalRefs = useRef<SVGPathElement>(null);
  const snowDropsRefs = useRef<SVGCircleElement[] | null[]>([]);
  const mainTimeline = useRef<GSAPTimeline>();
  gsap.registerPlugin(CustomEase);

  const { theme } = useContext(ThemeContext);

  const snowDropsColor = theme === 'light' ? '#b0e7ff' : '#fff';

  const snowDropsCircles = () => {
    let arr = [];

    for (let i = 0; i < 10; i++) {
      arr.push(
        <circle
          key={Math.exp(Math.random()) * Math.random()}
          ref={(element) => (snowDropsRefs.current[i] = element)}
          className='wi13t0'
          cx={45 + i * 94}
          cy={-80}
          r={40}
        />
      );
    }

    return arr;
  };

  useEffect(() => {
    mainTimeline.current = gsap
      .timeline({ repeat: -1, repeatRefresh: true })
      .to(snowDropsRefs.current, {
        duration: 5,
        x: 'random(-150, 150)',
        y: 'random(500,1500)',
        scale: 'random(0.5, 1.2)',
        opacity: '0',
        ease: 'linear',
        color: snowDropsColor,
        stagger: {
          each: 2,
          from: 'random',
          repeat: -1,
        },
      })
      .to(
        snowCrystalRefs.current,
        {
          duration: 10,
          scale: 'random(0.5, 1.1)',
          ease: 'poer2.inOut',
          transformOrigin: '50% 50%',
          repeat: -1,
          repeatRefresh: true,
        },
        '<'
      )
      .fromTo(
        snowCrystalRefs.current,
        {
          rotate: 0,
        },
        {
          duration: 0.75,
          rotate: 'random(-20, 20)',
          transformOrigin: '50% 50%',
          ease: CustomEase.create(
            'custom',
            'M0,0 C0.012,0.104 0.106,1 0.262,1 0.392,1 0.631,-1.004 0.724,-1.004 0.806,-1.004 0.906,-0.076 1,0'
          ),
          repeat: -1,
          repeatRefresh: true,
          repeatDelay: 5,
        },
        '<-3'
      );

    return () => {
      mainTimeline.current && mainTimeline.current.kill();
    };
  }, [snowDropsColor]);

  return (
    <svg
      id={styles['weather-13-svg']}
      xmlns='http://www.w3.org/2000/svg'
      viewBox='0 0 1000 1000'
    >
      <title>{props.description}</title>
      <style>{`.wi13t0{fill:${snowDropsColor}; filter: url(#snow-blur)}`}</style>
      <filter id='snow-blur' x='-100%' y='-100%' height='300%' width='300%'>
        <feGaussianBlur in='SourceGraphic' stdDeviation={10} result='BLUR' />
      </filter>
      <path
        ref={snowCrystalRefs}
        d='M879.8 481.1h-31.5l24.2-25.1c7.8-8.1 7.5-20.7-.5-28.6s-20.7-7.5-28.6.5L792 481.1h-37.4l23.7-25.1c7.5-8.1 7.3-21-.8-28.6s-21-7.3-28.6.8L698.8 481h-34.5l44.7-48.5c3.5-3.8 5.4-8.9 5.4-13.7v-.3c0-11-8.9-19.7-19.9-19.9l-62-.5 22.1-22.1h71.6c11 0 20.2-9.2 20.2-20.2s-9.2-20.2-20.2-20.2h-31.5l26.9-26.9h71.9c11 0 20.2-9.2 20.2-20.2s-9.2-20.2-20.2-20.2H762l21.5-21.5c7.8-7.8 7.8-20.7 0-28.6-7.8-7.8-20.7-7.8-28.6 0l-22.4 22.4-.5-35.3c-.3-11-9.2-20.5-20.2-20.5h-.3c-11 0-19.9 10-19.9 21l1.1 74.3-26.4 26.4-1.1-34.7c-.3-11-9.7-19.9-20.7-19.7-11 .3-19.9 9.7-19.7 20.7l1.9 72.7-23.2 23.2-.5-60.3c.8-5.7-1.1-11.6-5.1-15.9-7.5-8.4-20.7-8.9-29.1-1.3l-51.4 46.1v-37.7l53.3-50.1c8.1-7.5 8.6-20.5 1.1-28.6-7.5-8.1-20.7-8.4-28.8-.8l-25.6 23.7v-37.2l54.1-51.4c8.1-7.8 8.4-20.5.8-28.6-7.8-8.1-21-8.4-28.8-.5l-25.3 24.2v-30.2c0-11-9.2-20.2-20.2-20.2s-20.2 9.2-20.2 20.2v28.3l-21.5-22.1c-7.8-7.8-20.5-7.8-28.3 0-7.8 7.8-8.4 20.7-.3 28.6l50.4 50.6v37.2l-21.5-22.1c-7.8-7.8-20.5-7.8-28.3 0-7.8 7.8-8.4 20.7-.3 28.6l50.4 50.6v35L432.7 291c-8.1-7.8-20.5-7.5-28.3.5-4.6 4.6-6.2 10.8-5.4 16.7l-1.9 58.7-21.8-21.3v-71.9c0-11-9.2-20.2-20.2-20.2s-20.2 9.2-20.2 20.2v31.5L308 278.3v-71.9c0-11-9.2-20.2-20.2-20.2s-20.2 9.2-20.2 20.2v31.5l-21.3-21.5c-7.8-7.8-20.5-7.8-28.3 0-7.8 7.8-7.8 20.7 0 28.6l21.8 21.8-34.2.8c-11 .3-19.9 10-19.9 21 .3 11 9.2 20.2 20.2 20.2h.3l74.1-1.6 26.4 26.4-34.7 1.1c-11 .3-19.9 9.7-19.7 20.7.3 11 9.2 19.7 20.2 19.7h.5l72.7-1.9 25.3 25.3-62.2 1.3c-5.7.3-12.4 1.6-17 5.9-8.1 7.8-8.4 20.5-.8 28.6l.5.5c.5.5.8 1.1 1.3 1.3l43.1 45h-36.1L249.7 428c-7.5-8.1-20.5-8.4-28.6-.8-8.1 7.5-8.4 20.5-.8 28.6l23.7 25.3h-37.4L155.2 428c-7.8-8.1-20.5-8.4-28.6-.5-8.1 7.8-8.4 20.5-.5 28.6l24.2 25.1h-30.2c-11 0-20.2 9.2-20.2 20.2s9.2 20.2 20.2 20.2h28.3l-22.1 22.1c-7.8 7.8-7.8 20.7 0 28.6 4 4 9.2 5.9 14.3 5.9s10.2-1.9 14.3-5.9l50.6-50.6h37.2l-22.1 22.1c-7.8 7.8-7.8 20.7 0 28.6 4 4 9.2 5.9 14.3 5.9s10.2-1.9 14.3-5.9l50.6-50.6h35.6l-43.9 45.5c-7.8 8.1-7.5 20.7.5 28.6 3.8 3.5 8.6 5.4 13.5 5.7h.3l64.4 1.6-25.3 25.3-72.7-1.9c-11-.3-20.5 8.4-20.7 19.7-.3 11 8.4 20.5 19.7 20.7l34.7 1.1-27.3 26.9-73.3-1.1h-.3c-11 0-19.9 8.4-20.2 19.4-.3 11 8.6 19.7 19.9 19.9l35 .5-21.5 21.5c-7.8 7.8-7.8 20.7 0 28.6 4 4 9.2 5.9 14.3 5.9s10-1.9 13.7-5.9l18.6-18.9v31.2c0 11 9.2 20.2 20.2 20.2s20.2-9.2 20.2-20.2v-71.9l26.9-26.9V729c0 11 9.2 20.2 20.2 20.2s20.2-9.2 20.2-20.2v-72l26.1-25.6 1.6 61.1c-.5 5.7 1.6 12.1 5.9 16.4 4 4 9.4 6.5 14.5 6.5 6.2 0 11.6-4 14.8-7.8l42-41.8v32.9L427 749.3c-7.8 7.8-7.5 20.7.3 28.6 4 4 9.2 5.9 14.3 5.9s10-1.9 14-5.9l21.8-22.1V793L427 843.6c-7.8 7.8-7.5 20.7.3 28.6 4 4 9.2 5.9 14.3 5.9s10-1.9 14-5.9l21.8-22.1v29.6c0 11 9.2 20.2 20.2 20.2s20.2-9.2 20.2-20.2v-31.5l25.3 24.2c4 3.8 9.2 5.7 14.3 5.7 5.4 0 10.8-2.2 14.5-6.2 7.8-8.1 7.3-20.7-.8-28.6L517.8 792v-37.4l25.6 23.7c3.8 3.8 9.2 5.7 14 5.7 5.4 0 10.8-2.2 14.8-6.2 7.5-8.1 7-21-1.1-28.6l-53.3-50.1v-35.3l46.6 43.9c5.1 4.3 10 7.8 16.7 7.8h.3c11 0 20.2-9.2 20.2-20.2l.5-66 25.9 25.9-1.9 72.7c-.3 11 8.4 20.5 19.7 20.7h.5c10.8 0 19.9-8.6 20.2-19.7l1.1-34.7 26.4 26.4-1.1 73.8c-.3 11 8.6 20.5 19.9 20.5h.3c11 0 19.9-8.4 20.2-19.4l.5-35 21.3 21.3c4 4 9.2 5.9 14.3 5.9 5.1 0 10.2-1.9 14.3-5.9 7.8-7.8 7.8-20.7 0-28.6l-19.1-19.1h31.8c11 0 20.2-9.2 20.2-20.2s-9.2-20.2-20.2-20.2h-71.9l-26.9-26.9H729c11 0 20.2-9.2 20.2-20.2s-9.2-20.2-20.2-20.2h-72l-24.5-24.5 62-2.7c5.1-.3 10.5-2.7 13.7-5.9 8.1-7.8 8.1-20.5.3-28.6l-42.3-43.1h32.6l50.6 50.6c4 4 9.2 5.9 14.3 5.9 5.1 0 10.2-1.9 14.3-5.9 7.8-7.8 7.8-20.7 0-28.6l-22.1-22.1h37.2l50.6 50.6c4 4 9.2 5.9 14.3 5.9 5.1 0 10.2-1.9 14.3-5.9 7.8-7.8 7.8-20.7 0-28.6l-22.1-22.1h29.6c11 0 20.2-9.2 20.2-20.2 0-10.9-9.2-20.1-20.2-20.1zm-469.2-43.6 43.6 43.6h-62.8l-39.3-41.5 58.5-2.1zm-.8 126.1-57.1-1.6 39.1-40.4h60.3l-42.3 42zm67.8 45.5-38.2 38-1.3-55.2 39.6-39.9v57.1h-.1zm0-161.1-41.2-41.5 1.1-54.1 40.1 38.8V448zm40.4-55.7 45-40.4.3 57.4-45.5 45.3v-62.2h.2zm43.1 255.8-43.4-39.9v-62.8l43.4 43.4v59.3zm32.6-84.8L552 521.5h57.6l38.5 39.3-54.4 2.5zm15.7-82.2h-60.1l43.4-43.4 56.3.3-39.6 43.1'
        style={{
          fill: '#3385e4',
        }}
      />
      {snowDropsCircles()}
    </svg>
  );
};

export default WeatherIcon13;
